<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lumirax MVP</title>
  <style>
    body { font-family: Arial; margin: 0; background: #f0f7ff; display: flex; flex-direction: column; height: 100vh; }
    header { text-align: center; padding: 14px; background: #ffffffcc; backdrop-filter: blur(8px); font-size: 20px; font-weight: bold; }
    nav { display: flex; justify-content: center; gap: 12px; background: #fff; padding: 10px; }
    nav button { padding: 8px 16px; border-radius: 8px; border: 1px solid #bbb; cursor: pointer; font-size: 15px; }
    nav button.active { background: #0078ff; color: white; border: none; }
    #chatBox { flex: 1; overflow-y: auto; padding: 20px; }
    .bubble { padding: 12px 16px; margin: 10px 0; border-radius: 13px; max-width: 75%; }
    .me { background: #8ec5ff; color: white; margin-left: auto; }
    .bot { background: #ffffffd5; color: #222; margin-right: auto; }
    #inputBar { display: flex; padding: 10px; background: #fff; }
    #msgInput { flex: 1; font-size: 17px; padding: 10px; border-radius: 8px; border: 1px solid #ccc; }
    button.send { margin-left: 10px; padding: 10px 20px; border: none; background: #0077ff; color: white; border-radius: 8px; cursor: pointer; }
  </style>
</head>
<body>

<header>âœ¨ Lumirax â€” Web3 + AI å®‰å…¨å®ˆæŠ¤ âœ¨</header>

<nav>
  <button id="tabChat" class="active" onclick="switchTab('chat')">ğŸ’¬ AI èŠå¤©</button>
  <button id="tabRisk" onclick="switchTab('risk')">ğŸ›¡ Base é’±åŒ…é£é™©æ£€æµ‹</button>
</nav>

<div id="chatBox"></div>

<div id="inputBar">
  <input id="msgInput" type="text" placeholder="è¾“å…¥å†…å®¹..." />
  <button class="send" onclick="sendMessage()">å‘é€</button>
</div>

<script>
  let currentTab = "chat";
  const chatBox = document.getElementById("chatBox");
  const input = document.getElementById("msgInput");

  function addBubble(text, sender) {
    const div = document.createElement("div");
    div.className = "bubble " + sender;
    div.innerText = text;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function switchTab(tab) {
    currentTab = tab;
    document.getElementById("tabChat").classList.toggle("active", tab === "chat");
    document.getElementById("tabRisk").classList.toggle("active", tab === "risk");
    chatBox.innerHTML = "";
    input.value = "";

    if (tab === "chat") {
      addBubble("ä½ å¥½ï¼Œæˆ‘æ˜¯ Lumirax AIï¼Œå¯ä»¥é™ªä½ èŠå¤© ğŸŒ™", "bot");
    } else {
      addBubble("è¯·è¾“å…¥ Base é’±åŒ…åœ°å€ï¼Œæˆ‘å°†åˆ†æå®‰å…¨é£é™© ğŸ›¡", "bot");
    }
  }

  async function sendMessage() {
    const msg = input.value.trim();
    if (!msg) return;

    addBubble(msg, "me");
    input.value = "";

    addBubble("æ­£åœ¨åˆ†æä¸­â€¦â€¦", "bot");
    const thinking = chatBox.lastElementChild;

    let prompt = msg;
    if (currentTab === "risk") {
      prompt = `ä½ æ˜¯ä¸€ååŒºå—é“¾å®‰å…¨åˆ†æå¸ˆã€‚è¯·æ·±å…¥åˆ†æ Base é“¾é’±åŒ…é£é™©ï¼Œé’±åŒ…åœ°å€ï¼š${msg}ã€‚æ£€æŸ¥ï¼š
      - æ˜¯å¦å‘½ä¸­è¿‡å»è¯ˆéª—/é»‘åå•æ•°æ®åº“
      - äº¤æ˜“è¡Œä¸ºå’Œæ¨¡å¼æ˜¯å¦å¯ç–‘
      - ä¸é«˜é£é™©åˆçº¦çš„äº¤äº’
      - é£é™©ç­‰çº§ï¼ˆ0~100ï¼‰
      ç»™å‡ºç»“æ„åŒ–æ€»ç»“ã€‚`;
    }

    try {
      const res = await fetch("https://api.lmsys.org/v1/chat/completions", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          model: "deepseek-llm",
          messages: [{ role: "user", content: prompt }]
        })
      });
      const data = await res.json();
      thinking.remove();
      addBubble(data.choices?.[0]?.message?.content || "æ— è¾“å‡º", "bot");
    } catch (e) {
      thinking.remove();
      addBubble("âŒ è¯·æ±‚å¤±è´¥ï¼Œç¨åå†è¯•", "bot");
      console.error(e);
    }
  }

  input.addEventListener("keydown", e => e.key === "Enter" && sendMessage());
  switchTab("chat");
</script>

</body>
</html>
