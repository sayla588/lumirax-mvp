<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiviChain - 区块链安全分析平台</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">

    <!-- Google Translate -->
    <div id="google_translate_element" style="position:fixed; top:80px; right:20px; z-index:9999;"></div>
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'zh-CN',
                includedLanguages: 'zh-CN,en,ja,ko',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                autoDisplay: false
            }, 'google_translate_element');
        }
    </script>
    <script type="text/javascript"
        src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</head>

<body>

<!-- ================== 导航栏 ================== -->
<nav class="navbar">
    <div class="logo">
        <i class="fa-solid fa-shield-halved"></i> MiviChain
    </div>
    <ul class="nav-links">
        <li><a href="index.html" class="nav-link active">首页</a></li>
        <li><a href="scanner.html" class="nav-link">链上扫描</a></li>
        <li><a href="risk.html" class="nav-link">风险透视</a></li>
        <li><a href="verify.html" class="nav-link">验证工具</a></li>
    </ul>

    <div class="nav-actions">
        <button class="btn-login" onclick="openAuthModal()">登录 / 注册</button>
    </div>

    <div class="hamburger">
        <i class="fa-solid fa-bars"></i>
    </div>
</nav>

<!-- ================== Hero ================== -->
<header class="hero">
    <div class="hero-content">
        <h1>守护您的链上资产安全</h1>
        <p>利用 AI 驱动的智能合约审计与实时风险监控，为您的 Web3 之旅保驾护航。</p>

        <div class="hero-buttons">
            <a href="scanner.html" class="btn-primary">开始扫描合约</a>
            <a href="risk.html" class="btn-secondary">检查钱包风险</a>

            <!-- VIP 下载按钮 -->
            <a id="proDownloadBtn"
               href="javascript:void(0)"
               onclick="downloadDesktopApp()"
               class="btn-primary vip-download-btn"
               style="display:none;">
                <i class="fa-solid fa-download"></i>
                下载 MiviChain Pro 桌面程序（VIP）
            </a>
        </div>
    </div>
    <div class="hero-bg-animation"></div>
</header>

<!-- ================== 核心功能 ================== -->
<section class="features">
    <div class="section-title">
        <h2>核心功能</h2>
        <p>全方位的区块链安全解决方案</p>
    </div>

    <div class="feature-grid">
        <div class="feature-card">
            <div class="icon-box">
                <i class="fa-solid fa-magnifying-glass-chart"></i>
            </div>
            <h3>智能合约扫描</h3>
            <p>深度分析合约代码漏洞，识别貔貅盘、后门代码及权限滥用风险。</p>
            <a href="scanner.html" class="card-link">立即使用 →</a>
        </div>

        <div class="feature-card">
            <div class="icon-box">
                <i class="fa-solid fa-wallet"></i>
            </div>
            <h3>钱包风险透视</h3>
            <p>一键检测钱包授权情况，发现恶意授权并提供取消建议。</p>
            <a href="risk.html" class="card-link">立即使用 →</a>
        </div>

        <div class="feature-card">
            <div class="icon-box">
                <i class="fa-solid fa-check-double"></i>
            </div>
            <h3>项目真伪验证</h3>
            <p>基于多维度数据验证项目官方渠道，远离钓鱼网站。</p>
            <a href="verify.html" class="card-link">立即使用 →</a>
        </div>
    </div>
</section>

<!-- ================== 统计 ================== -->
<section class="stats">
    <div class="stat-item">
        <span class="stat-number">100W+</span>
        <span class="stat-label">已扫描合约</span>
    </div>
    <div class="stat-item">
        <span class="stat-number">$50M+</span>
        <span class="stat-label">挽回潜在损失</span>
    </div>
    <div class="stat-item">
        <span class="stat-number">24/7</span>
        <span class="stat-label">实时监控</span>
    </div>
</section>

<!-- ================== 页脚 ================== -->
<footer>
    <div class="footer-content">
        <div class="footer-logo">
            <i class="fa-solid fa-shield-halved"></i> MiviChain
        </div>
        <p>&copy; 2025 MiviChain Security. All rights reserved.</p>
    </div>
</footer>

<!-- ================== JS ================== -->

<script>
/* 移动端菜单 */
document.querySelector(".hamburger").addEventListener("click", () => {
    document.querySelector(".nav-links").classList.toggle("active");
});

/* ================== VIP 下载逻辑（关键修复） ================== */
async function downloadDesktopApp() {
    const wallet = localStorage.getItem("wallet");

    if (!wallet) {
        alert("请先登录");
        return;
    }

    try {
        const res = await fetch("/api/download", {
            method: "GET",
            headers: {
                "x-wallet-address": wallet
            }
        });

        if (res.status === 401) {
            alert("请先登录");
            return;
        }

        if (res.status === 403) {
            alert("仅限 VIP 用户下载");
            return;
        }

        if (!res.ok) {
            alert("下载失败，请稍后再试");
            return;
        }

        // ✅ 正确处理 exe（二进制）
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "mivichain-pro-guard.exe";
        document.body.appendChild(a);
        a.click();

        a.remove();
        URL.revokeObjectURL(url);

    } catch (e) {
        console.error(e);
        alert("下载异常，请稍后再试");
    }
}
</script>
<script>
/* ========= 登录弹窗控制（补齐缺失函数） ========= */

function openAuthModal() {
    document.getElementById("authModal").style.display = "flex";
}

function closeAuthModal() {
    document.getElementById("authModal").style.display = "none";
}

function switchAuthTab(type) {
    const loginTab = document.getElementById("tab-login");
    const registerTab = document.getElementById("tab-register");
    const loginForm = document.getElementById("form-login");
    const registerForm = document.getElementById("form-register");

    if (type === "login") {
        loginTab.classList.add("active");
        registerTab.classList.remove("active");
        loginForm.classList.add("active");
        registerForm.classList.remove("active");
    } else {
        registerTab.classList.add("active");
        loginTab.classList.remove("active");
        registerForm.classList.add("active");
        loginForm.classList.remove("active");
    }
}
</script>

<!-- 登录 / 注册逻辑 -->
<script src="auth.js"></script>

</body>
</html>
