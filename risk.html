<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>风险透视 - 链上卫士</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- 导航栏 (已修正：链接居中，右侧显示登录状态) -->
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fas fa-shield-alt"></i> 链上卫士
        </div>
        
        <!-- 中间导航链接 -->
        <div class="nav-links">
            <a href="index.html" class="nav-item">首页</a>
            <a href="scanner.html" class="nav-item">智能扫描</a>
            <a href="risk.html" class="nav-item active">风险透视</a>
            <a href="verify.html" class="nav-item">官方验证</a>
        </div>

        <!-- 右侧登录/用户状态 -->
        <div class="nav-auth">
            <!-- 未登录状态 -->
            <button id="navLoginBtn" class="btn-login" onclick="openAuthModal()">
                <i class="fas fa-user"></i> 登录 / 注册
            </button>
            
            <!-- 已登录状态 (默认隐藏) -->
            <div id="navUserArea" class="user-area" style="display: none;">
                <span id="navUsername" class="username">User</span>
                <button class="btn-logout" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- 页面主要内容 -->
    <div class="risk-container">
        <header class="risk-header">
            <h1><i class="fas fa-chart-radar"></i> 全局风险态势感知</h1>
            <p>基于全网数据的实时威胁监控大屏</p>
        </header>

        <!-- 核心指标卡片 -->
        <div class="risk-stats">
            <div class="stat-card danger">
                <div class="stat-icon"><i class="fas fa-virus"></i></div>
                <div class="stat-info">
                    <h3>今日高危合约</h3>
                    <div class="stat-num">1,284</div>
                    <div class="stat-trend up">+12% <i class="fas fa-arrow-up"></i></div>
                </div>
            </div>
            <div class="stat-card warning">
                <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <div class="stat-info">
                    <h3>潜在风险地址</h3>
                    <div class="stat-num">8,932</div>
                    <div class="stat-trend up">+5% <i class="fas fa-arrow-up"></i></div>
                </div>
            </div>
            <div class="stat-card success">
                <div class="stat-icon"><i class="fas fa-shield-check"></i></div>
                <div class="stat-info">
                    <h3>已拦截攻击</h3>
                    <div class="stat-num">45,201</div>
                    <div class="stat-trend">实时保护中</div>
                </div>
            </div>
            <div class="stat-card info">
                <div class="stat-icon"><i class="fas fa-cube"></i></div>
                <div class="stat-info">
                    <h3>监控区块高度</h3>
                    <div class="stat-num">18,234,901</div>
                    <div class="stat-trend">正常出块</div>
                </div>
            </div>
        </div>

        <!-- 图表区域 -->
        <div class="charts-grid">
            <!-- 攻击类型分布 -->
            <div class="chart-box">
                <div class="chart-header">
                    <h3><i class="fas fa-chart-pie"></i> 攻击类型分布 (24h)</h3>
                </div>
                <div class="chart-body">
                    <canvas id="attackTypeChart"></canvas>
                </div>
            </div>

            <!-- 风险趋势 -->
            <div class="chart-box">
                <div class="chart-header">
                    <h3><i class="fas fa-chart-line"></i> 风险合约检出趋势 (7天)</h3>
                </div>
                <div class="chart-body">
                    <canvas id="riskTrendChart"></canvas>
                </div>
            </div>

            <!-- 活跃黑名单地址 -->
            <div class="chart-box wide">
                <div class="chart-header">
                    <h3><i class="fas fa-list-ul"></i> 实时高危地址监控</h3>
                </div>
                <div class="risk-table-wrapper">
                    <table class="risk-table">
                        <thead>
                            <tr>
                                <th>时间</th>
                                <th>地址</th>
                                <th>风险类型</th>
                                <th>风险等级</th>
                                <th>状态</th>
                            </tr>
                        </thead>
                        <tbody id="riskTableBody">
                            <!-- JS动态填充 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 登录/注册 模态框 (必须包含在每个页面底部) -->
    <div id="authModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" onclick="closeAuthModal()">&times;</button>
            
            <div class="auth-tabs">
                <button id="tab-login" class="auth-tab active" onclick="switchAuthTab('login')">登录</button>
                <button id="tab-register" class="auth-tab" onclick="switchAuthTab('register')">注册</button>
            </div>

            <!-- 登录表单 -->
            <form id="form-login" class="auth-form active" onsubmit="handleLogin(event)">
                <input type="text" id="loginUser" class="auth-input" placeholder="用户名" required>
                <input type="password" id="loginPass" class="auth-input" placeholder="密码" required>
                <button type="submit" class="btn-full">立即登录</button>
                <div id="loginMsg" class="auth-msg"></div>
            </form>

            <!-- 注册表单 -->
            <form id="form-register" class="auth-form" onsubmit="handleRegister(event)">
                <input type="text" id="regUser" class="auth-input" placeholder="设置用户名" required>
                <input type="password" id="regPass" class="auth-input" placeholder="设置密码" required>
                <button type="submit" class="btn-full" style="background: transparent; border: 1px solid var(--primary-color); color: #fff;">创建账户</button>
                <div id="regMsg" class="auth-msg"></div>
            </form>
        </div>
    </div>

    <!-- 引入脚本 -->
    <script src="auth.js"></script>
    <script>
        // 初始化图表
        document.addEventListener('DOMContentLoaded', function() {
            // 1. 饼图：攻击类型
            const ctxPie = document.getElementById('attackTypeChart').getContext('2d');
            new Chart(ctxPie, {
                type: 'doughnut',
                data: {
                    labels: ['貔貅盘 (Honeypot)', 'Rug Pull', '闪电贷攻击', '钓鱼授权', '其他'],
                    datasets: [{
                        data: [45, 25, 15, 10, 5],
                        backgroundColor: [
                            '#ff4757', // 红
                            '#ffa502', // 橙
                            '#2ed573', // 绿
                            '#1e90ff', // 蓝
                            '#a4b0be'  // 灰
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right', labels: { color: '#fff' } }
                    }
                }
            });

            // 2. 折线图：趋势
            const ctxLine = document.getElementById('riskTrendChart').getContext('2d');
            new Chart(ctxLine, {
                type: 'line',
                data: {
                    labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
                    datasets: [{
                        label: '高危合约数量',
                        data: [120, 132, 101, 134, 290, 230, 210],
                        borderColor: '#00f2ff',
                        backgroundColor: 'rgba(0, 242, 255, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#fff' } },
                        x: { grid: { display: false }, ticks: { color: '#fff' } }
                    },
                    plugins: { legend: { labels: { color: '#fff' } } }
                }
            });

            // 3. 填充表格数据
            const tableBody = document.getElementById('riskTableBody');
            const mockData = [
                { time: '10:23:45', addr: '0x8a...9c21', type: 'Honeypot', level: '高危', status: '已标记' },
                { time: '10:22:12', addr: '0x1b...4d55', type: 'Rug Pull', level: '高危', status: '已标记' },
                { time: '10:18:30', addr: '0x9c...e112', type: '钓鱼', level: '中危', status: '监控中' },
                { time: '10:15:05', addr: '0x3f...a889', type: '假冒代币', level: '高危', status: '已标记' },
                { time: '10:10:22', addr: '0x7d...b221', type: '异常转账', level: '低危', status: '分析中' },
            ];

            mockData.forEach(item => {
                const row = `
                    <tr>
                        <td>${item.time}</td>
                        <td class="font-mono">${item.addr}</td>
                        <td>${item.type}</td>
                        <td><span class="badge ${item.level === '高危' ? 'badge-danger' : (item.level === '中危' ? 'badge-warning' : 'badge-info')}">${item.level}</span></td>
                        <td>${item.status}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        });
    </script>
</body>
</html>
